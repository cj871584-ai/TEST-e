<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•¸å­¸ç‰©èªï¼šç„¡é™çš„æ•™å®¤ (éŸ³æ¨‚å¢å¼·ç‰ˆ)</title>
    <style>
        :root {
            --primary-bg: #2c3e50;
            --box-bg: rgba(0, 0, 0, 0.85);
            --text-color: #ffffff;
            --accent: #f1c40f;
        }

        body {
            font-family: 'Segoe UI', "Microsoft JhengHei", sans-serif;
            background-color: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            width: 100vw;
            height: 100vh;
            max-width: 1024px;
            max-height: 768px;
            position: relative;
            background: #444;
            border: 4px solid #333;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            overflow: hidden;
        }

        /* æ•™å®¤èƒŒæ™¯ */
        #background {
            position: absolute;
            width: 100%;
            height: 100%;
            background: 
                linear-gradient(rgba(0,0,0,0.2), rgba(0,0,0,0.2)),
                url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600" viewBox="0 0 800 600"><rect width="800" height="600" fill="%23dcdde1"/><rect x="100" y="100" width="600" height="300" fill="%232f3640" stroke="%2384817a" stroke-width="10"/><rect x="0" y="450" width="800" height="150" fill="%237158e2" opacity="0.2"/><line x1="0" y1="450" x2="800" y2="450" stroke="%2384817a" stroke-width="5"/></svg>');
            background-size: cover;
            z-index: 1;
        }

        /* éŸ³æ¨‚æ§åˆ¶é¢æ¿ */
        #audio-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 300;
            background: rgba(0,0,0,0.6);
            padding: 10px;
            border-radius: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
            border: 1px solid var(--accent);
        }

        .audio-btn {
            background: none;
            border: none;
            color: var(--accent);
            cursor: pointer;
            font-size: 1.2rem;
            outline: none;
        }

        /* ç«‹ç¹ªå®¹å™¨ */
        .character-container {
            position: absolute;
            bottom: 120px;
            width: 100%;
            height: 70%;
            display: flex;
            justify-content: space-around;
            align-items: flex-end;
            z-index: 2;
            padding: 0 50px;
            box-sizing: border-box;
        }

        .sprite {
            width: 250px;
            height: 450px;
            transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            filter: brightness(0.4) grayscale(0.5);
            transform: translateY(50px);
            opacity: 0;
        }

        .sprite.active {
            filter: brightness(1) grayscale(0);
            transform: translateY(0) scale(1.05);
            opacity: 1;
            z-index: 10;
        }

        .sprite.visible {
            opacity: 1;
        }

        /* å°è©±æ¡†æ¨£å¼ */
        #ui-layer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 180px;
            background: var(--box-bg);
            border-top: 4px solid var(--accent);
            z-index: 100;
            padding: 25px;
            box-sizing: border-box;
            color: var(--text-color);
            cursor: pointer;
        }

        #speaker-name {
            font-size: 1.4rem;
            color: var(--accent);
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        #dialogue-content {
            font-size: 1.2rem;
            line-height: 1.6;
        }

        /* é¸é …èˆ‡æŒ‰éˆ• */
        #choice-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
            gap: 20px;
        }

        .choice-btn {
            width: 60%;
            padding: 18px;
            background: white;
            color: #2c3e50;
            border-radius: 50px;
            text-align: center;
            font-weight: bold;
            cursor: pointer;
            transition: 0.3s;
            border: 3px solid var(--accent);
            font-size: 1.1rem;
        }

        .choice-btn:hover {
            transform: scale(1.05);
            background: var(--accent);
            color: white;
        }

        #next-indicator {
            position: absolute;
            bottom: 20px;
            right: 30px;
            font-size: 0.9rem;
            color: var(--accent);
            animation: blink 1s infinite;
        }

        @keyframes blink { 50% { opacity: 0; } }
        
        .ending-tag {
            font-size: 1.8rem;
            color: var(--accent);
            font-weight: bold;
        }
    </style>
</head>
<body>

<audio id="bgm" loop>
    <source src="https://www.chosic.com/wp-content/uploads/2021/04/Warm-Light.mp3" type="audio/mpeg">
</audio>

<div id="game-container">
    <div id="background"></div>
    
    <div id="audio-controls">
        <button id="mute-btn" class="audio-btn" onclick="gameLogic.toggleMute()">ğŸ”Š</button>
        <span style="font-size: 0.8rem;">BGM: On</span>
    </div>
    
    <div class="character-container">
        <svg id="sprite-teacher" class="sprite" viewBox="0 0 200 400">
            <rect x="60" y="80" width="80" height="85" fill="#e74c3c" rx="5" /> <rect x="40" y="170" width="120" height="230" fill="#c0392b" /> <rect x="92" y="170" width="16" height="80" fill="#fff" opacity="0.9" /> <circle cx="85" cy="115" r="4" fill="black"/> <circle cx="115" cy="115" r="4" fill="black"/>
        </svg>

        <svg id="sprite-studentA" class="sprite" viewBox="0 0 200 400">
            <circle cx="100" cy="110" r="45" fill="#3498db" /> <rect x="55" y="160" width="90" height="240" fill="#2980b9" rx="20" /> <path d="M 85 130 Q 100 145 115 130" stroke="white" stroke-width="3" fill="none" /> </svg>

        <svg id="sprite-studentB" class="sprite" viewBox="0 0 200 400">
            <circle cx="100" cy="110" r="45" fill="#2ecc71" /> <rect x="65" y="160" width="70" height="240" fill="#27ae60" rx="10" /> <line x1="85" y1="110" x2="95" y2="110" stroke="#111" stroke-width="2"/> <line x1="105" y1="110" x2="115" y2="110" stroke="#111" stroke-width="2"/>
        </svg>
    </div>

    <div id="choice-overlay"></div>

    <div id="ui-layer" onclick="gameLogic.next()">
        <div id="speaker-name">ç³»çµ±</div>
        <div id="dialogue-content">ï¼ˆç’°å¢ƒéŸ³ï¼šæ‚ æšçš„æ ¡åœ’åˆå¾Œï¼‰<br>é»æ“Šç•«é¢é–‹å§‹æ•¸å­¸èª²...</div>
        <div id="next-indicator">NEXT â–¶</div>
    </div>
</div>

<script>
    let playerCorrect = false;
    let musicStarted = false;

    const gameScript = [
        { speaker: 'æ•¸å­¸è€å¸«', text: 'ï¼ˆè¼•æ•²é»‘æ¿ï¼‰å„ä½åŒå­¸ï¼Œä»Šå¤©æˆ‘å€‘ä¾†è«‡è«‡ã€Œç„¡é™ã€èˆ‡ã€Œæ¥µé™ã€ã€‚', active: 'teacher' },
        { speaker: 'å­¸ç”Ÿç”²', text: 'ç„¡é™ï¼Ÿæ˜¯é‚£å€‹åƒå€’ä¸‹ä¾†çš„ 8 çš„ç¬¦è™Ÿå—ï¼Ÿæ„Ÿè¦ºå¥½ç„å–”ï¼', active: 'studentA' },
        { speaker: 'æ•¸å­¸è€å¸«', text: 'å‘µå‘µï¼Œæ²’éŒ¯ã€‚ä½†æ•¸å­¸ä¸åªæ˜¯ç¬¦è™Ÿã€‚æƒ³åƒä½ æœ‰ä¸€å¡ŠæŠ«è–©...', active: 'teacher' },
        { speaker: 'æ•¸å­¸è€å¸«', text: 'å¦‚æœä½ æ¯æ¬¡åƒæ‰å‰©ä¸‹çš„ä¸€åŠï¼Œå†åƒæ‰å‰©ä¸‹çš„ä¸€åŠ... é€™æ¨£ç„¡é™å¾ªç’°ï¼Œä½ æœ€å¾ŒçœŸçš„èƒ½æŠŠå®ƒã€Œåƒå®Œã€å—ï¼Ÿ', active: 'teacher', hasChoices: true },
        
        { id: 'wrong_path', speaker: 'æ•¸å­¸è€å¸«', text: 'å¯æƒœï¼Œåœ¨ç´”ç²¹çš„æ•¸å­¸å®šç¾©ä¸­ï¼Œåªè¦ä½ æ¯æ¬¡éƒ½åªåƒã€Œä¸€åŠã€ï¼Œå‰©é¤˜é‡å°±æ°¸é ä¸æœƒæ­¸é›¶ã€‚', active: 'teacher' },
        { id: 'wrong_path', speaker: 'å­¸ç”Ÿç”²', text: 'æ‰€ä»¥æˆ‘å°±ç®—åƒäº†ä¸€è¬å¹´ï¼Œé‚„æ˜¯æœƒå‰©ä¸‹ä¸€é»é»åˆ†å­ï¼Ÿé€™å¤ªä¸ç¬¦åˆèƒƒå£äº†ï¼', active: 'studentA' },
        
        { id: 'right_path', speaker: 'æ•¸å­¸è€å¸«', text: 'æ­£ç¢ºï¼é€™å°±æ˜¯ã€Œæ”¶æ–‚ã€çš„æ¦‚å¿µï¼Œå®ƒç„¡é™è¶¨è¿‘æ–¼ 0ï¼Œä½†æ°¸é ä¸ç­‰æ–¼ 0ã€‚', active: 'teacher' },
        { id: 'right_path', speaker: 'å­¸ç”Ÿä¹™', text: 'é€™ç¨®æ°¸ä¸äº¤æœƒçš„é—œä¿‚ï¼Œè½èµ·ä¾†ç«Ÿç„¶æœ‰é»æµªæ¼«ã€‚', active: 'studentB' },
        
        { speaker: 'æ•¸å­¸è€å¸«', text: 'ç„¡é™å¤§èˆ‡ç„¡é™å°ï¼Œæ˜¯é€šå¾€é«˜æ·±æ•¸å­¸çš„é–€ç¥¨ã€‚ä»Šå¤©çš„èª²å°±åˆ°é€™è£¡ã€‚', active: 'teacher' },
        { id: 'end_entry', isEnding: true }
    ];

    const gameLogic = {
        index: -1,
        bgm: document.getElementById('bgm'),
        sprites: {
            teacher: document.getElementById('sprite-teacher'),
            studentA: document.getElementById('sprite-studentA'),
            studentB: document.getElementById('sprite-studentB')
        },

        toggleMute() {
            this.bgm.muted = !this.bgm.muted;
            document.getElementById('mute-btn').textContent = this.bgm.muted ? "ğŸ”‡" : "ğŸ”Š";
        },

        startMusic() {
            if (!musicStarted) {
                this.bgm.play().catch(e => console.log("ç­‰å¾…ç”¨æˆ¶äº¤äº’ä»¥æ’­æ”¾éŸ³æ¨‚"));
                musicStarted = true;
            }
        },

        next() {
            this.startMusic(); // ç¬¬ä¸€æ¬¡é»æ“Šæ™‚å•Ÿå‹•éŸ³æ¨‚

            if (document.getElementById('choice-overlay').style.display === 'flex') return;

            this.index++;
            let step = gameScript[this.index];

            if (!step) return;

            if (step.isEnding) {
                this.showEnding();
                return;
            }

            // åˆ†æ”¯é‚è¼¯
            if (step.id === 'wrong_path' && playerCorrect) { this.next(); return; }
            if (step.id === 'right_path' && !playerCorrect) { this.next(); return; }

            this.render(step);
        },

        render(step) {
            document.getElementById('speaker-name').textContent = step.speaker;
            document.getElementById('dialogue-content').textContent = step.text;

            Object.values(this.sprites).forEach(s => s.classList.remove('active'));
            if (this.sprites[step.active]) {
                this.sprites[step.active].classList.add('active', 'visible');
            }

            if (step.hasChoices) {
                this.showChoices();
            }
        },

        showChoices() {
            const overlay = document.getElementById('choice-overlay');
            overlay.style.display = 'flex';
            overlay.innerHTML = `
                <div class="choice-btn" onclick="makeChoice(false)">è‚¯å®šèƒ½åƒå®Œï¼Œåªæ˜¯æ™‚é–“å•é¡Œï¼</div>
                <div class="choice-btn" onclick="makeChoice(true)">æ°¸é åƒä¸å®Œï¼Œæœ€å¾Œæœƒå‰©ä¸‹æ¥µå°çš„ä¸€é»</div>
            `;
        },

        makeChoice(correct) {
            playerCorrect = correct;
            document.getElementById('choice-overlay').style.display = 'none';
            this.next();
        },

        showEnding() {
            const title = playerCorrect ? "ã€çµå±€ï¼šç„¡é™å¤§å¸«ã€‘" : "ã€çµå±€ï¼šç„¡é™å…¥é–€è€…ã€‘";
            const desc = playerCorrect ? "ä½ ç²¾æº–çš„é‚è¼¯æ€ç¶­è®“è€å¸«å°è±¡æ·±åˆ»ï¼Œæˆ–è¨±ä½ å…·å‚™æˆç‚ºæ•¸å­¸å®¶çš„æ½›è³ªã€‚" : "é›–ç„¶ç›´è¦ºä¸Šæƒ³æŠŠå®ƒåƒå®Œï¼Œä½†åœ¨æ•¸å­¸ä¸–ç•Œè£¡ï¼Œæœ‰æ™‚å€™ã€Œæ°¸é åˆ°ä¸äº†ã€æ‰æ˜¯çœŸç›¸ã€‚";
            
            document.getElementById('speaker-name').textContent = "ç³»çµ±é€šçŸ¥";
            document.getElementById('dialogue-content').innerHTML = `<span class="ending-tag">${title}</span><br>${desc}`;
            document.getElementById('next-indicator').textContent = "å†æ¬¡æŒ‘æˆ° â†º";
            document.getElementById('ui-layer').onclick = () => location.reload();
        }
    };

    window.makeChoice = (val) => gameLogic.makeChoice(val);
</script>

</body>
</html>